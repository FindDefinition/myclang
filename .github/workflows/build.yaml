name: build

on:
  push:
    branches:
      - master
    tags:
      - '*'
  
jobs:
  # build-windows:
  #   runs-on: windows-latest
  #   strategy:
  #     matrix:
  #       python-version: [3.8]
  #   steps:
  #     - uses: actions/checkout@master
  #     - name: Set up Python ${{ matrix.python-version }}
  #       uses: actions/setup-python@v2
  #       with:
  #         python-version: ${{ matrix.python-version }}
  #     - uses: ilammy/msvc-dev-cmd@v1
  #     - name: download clang
  #       run: |
  #         curl -o $HOME/llvm.tar.xz https://ziglang.org/deps/llvm%2bclang%2blld-11.0.0-x86_64-windows-msvc-release-mt.tar.xz
  #         Install-Module -Name 7Zip4Powershell
  #         Expand-7Zip $HOME/llvm.tar.xz $HOME/llvm
  #         Expand-7Zip $HOME//llbv/llvm.tar $HOME/llvm
  #         mv $HOME/llvm/llvm+clang+lld-11.0.0-x86_64-windows-msvc-release-mt $HOME/llvm/llvm
  #       shell: powershell

  #     - name: test
  #       run: |
  #         set CLANG_LIBRARY_PATH=$HOME/llvm/llvm
  #         python -m pip install --upgrade pip twine wheel
  #         python -m pip install pytest
  #         python -m pip install -e .
  #         pytest ./test

  build:
    # needs: build-windows
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        python-version: [3.8]

    steps:
      - uses: actions/checkout@master
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
      - name: download clang
        run: |
          wget https://github.com/llvm/llvm-project/releases/download/llvmorg-11.0.0/clang+llvm-11.0.0-x86_64-linux-gnu-ubuntu-20.04.tar.xz -q -O $HOME/llvm.tar.xz 
          tar xf $HOME/llvm.tar.xz -C $HOME
          mv $HOME/clang+llvm-11.0.0-x86_64-linux-gnu-ubuntu-20.04 $HOME/llvm
          rm -rf $HOME/llvm.tar.xz
      - name: test
        run: |
          export CLANG_LIBRARY_PATH=$HOME/llvm
          python -m pip install --upgrade pip twine wheel
          python -m pip install pytest
          python -m pip install -e .
          pytest ./test
